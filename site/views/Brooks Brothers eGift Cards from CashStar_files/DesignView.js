var DesignView=DesignView||{};!function(e){"use strict";DesignView=Backbone.View.extend({el:"#carousel-pane-container",events:{"click .items img":"setNewFaceplate"},initialize:function(e){Backbone.View.prototype.initialize.apply(this,arguments),this.viewModel=e.viewModel,this.faceplate=e.faceplate,this.denomination=e.denomination,this.listenTo(this.faceplate,"change",this.setThumbStyle),this.listenToOnce(this.viewModel,"change:display_type",this.manualSelectNewDefaultFP),this.api_scrollable={},this.scrollData={},this.initialDcRun=!0,this.initialLoad=!0,this.initialTab=jsonData.initialDesignTabIndex||0,this.shouldGoTo=[],this.setupDesignCenter(),this.setInitialFaceplate(),this.predenomCheck()},render:function(e,t){this.renderDesignCenter(e,t)},renderDesignCenter:function(t,i){var a=this;this.$("#fp-panes").fadeOut(0,function(){e(this).html(t),a._setScrollable(),a.api_scrollable=a.$("#fp-panes > div").eq(i).children(".scrollable").data("scrollable"),a.api_scrollable&&1===a.api_scrollable.getSize()?a.api_scrollable.getNaviButtons().css("visibility","hidden"):a.api_scrollable&&a.api_scrollable.getNaviButtons().css("visibility","visible"),a.$("#fp-panes .hidden_field").hide(),a.initialLoad&&(a.initialLoad=!1)}),this.$("#fp-panes").fadeIn(),this.setThumbStyle()},setupDesignCenter:function(){var t=this;t._setScrollable(),e.easing.cashscroll=function(e,t,i,a,s){var l=.85;return(t/=s/2)<1?a/2*(t*t*(((l*=1.525)+1)*t-l))+i:a/2*((t-=2)*t*(((l*=1.525)+1)*t+l)+2)+i},this.$("#fp-nav").tabs("#fp-panes > div",{fadeInSpeed:300,fadeOutSpeed:0,effect:"fade",initialIndex:jsonData.initialDesignTabIndex,onBeforeClick:function(i,a){if(t.initialDcRun?(t.shouldGoTo=this.getTabs().eq(t.initialTab),t.initialDcRun=!1):t.shouldGoTo=this.getTabs().eq(a),t.shouldGoTo){var s=t.shouldGoTo.attr("href");e.ajax({url:s,error:function(e,t,i){},success:function(e,i){t.render(e,i)}})}}})},_setScrollable:function(){e(".scrollable").length>0&&(this.$(".scrollable").scrollable({easing:"cashscroll",speed:1e3}).navigator(),this.scrollData=e(".scrollable").data("scrollable"),1===this.scrollData.getItems().length&&this.$("a.browse, .navi").css("visibility","hidden"))},manualSelectNewDefaultFP:function(){this.viewModel.get("is_editing")&&this.faceplate.get("default_faceplate_full_url")===this.faceplate.get("uyo_faceplate")&&this.$(".items").find("img").first().trigger("click")},setInitialFaceplate:function(){this.faceplate.set("carousel_selected_fp_code",this.faceplate.get("default_faceplate")),this.faceplate.set("carousel_selected_fp_url",this.faceplate.get("default_faceplate_full_url")),this.setThumbStyle()},setThumbStyle:function(){var e=this.faceplate.get("carousel_selected_fp_code"),t=this.$(".faceplate-group").find('img[data-pk="'+e+'"]');this.$(".faceplate-group").find("img").removeClass("selected"),t.addClass("selected")},predenomCheck:function(){var e=this.faceplate.get("carousel_selected_fp_code"),t=this.$(".faceplate-group").find('img[data-pk="'+e+'"]').data("denom");t&&this.denomination.set("predenom_denom",t)},setNewFaceplate:function(t){t.preventDefault();var i=e(t.currentTarget),a={denom:i.data("denom"),new_url:i.data("full-url"),pk:i.data("pk")};a.denom?(this.denomination.set("is_predenom",!0),this.denomination.set("predenom_denom",a.denom)):(this.denomination.set("is_predenom",!1),this.denomination.set("predenom_denom","")),this.faceplate.set("carousel_selected_fp_url",a.new_url),this.faceplate.set("carousel_selected_fp_code",a.pk)}})}(jQuery);
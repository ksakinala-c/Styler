!function(e){e.fn.uploadProgress=function(r){return r=e.extend({interval:2e3,progressBar:"#progressbar",progressUrl:"/progress",start:function(){},uploading:function(){},complete:function(){},success:function(){},error:function(){},preloadImages:[],uploadProgressPath:"/javascripts/jquery.uploadProgress.js",jqueryPath:"/javascripts/jquery.js",timer:""},r),e(function(){for(var t=0;t<r.preloadImages.length;t++)r.preloadImages[t]=e("<img>").attr("src",r.preloadImages[t]);if(e.browser.webkit){iframe=document.createElement("iframe"),iframe.name="progressFrame",e(iframe).css({width:"0",height:"0",position:"absolute",top:"-3000px"}),document.body.appendChild(iframe);var o=iframe.contentWindow.document;o.open(),o.write("<html><head></head><body></body></html>"),o.close();var s=o.body,a=o.createElement("script");a.src=r.jqueryPath,a.onload=function(){var e=o.createElement("script");e.src=r.uploadProgressPath,s.appendChild(e)},s.appendChild(a)}}),this.each(function(){e(this).bind("submit",function(){var t="";for(i=0;i<32;i++)t+=Math.floor(16*Math.random()).toString(16);if(r.uuid=t,r.start(),old_id=/X-Progress-ID=([^&]+)/.exec(e(this).attr("action"))){var o=e(this).attr("action").replace(old_id[1],t);e(this).attr("action",o)}else e(this).attr("action",jQuery(this).attr("action")+"?X-Progress-ID="+t);var s=e.browser.webkit?progressFrame.jQuery.uploadProgress:jQuery.uploadProgress;r.timer=window.setInterval(function(){s(this,r)},r.interval)})})},jQuery.uploadProgress=function(r,t){jQuery.ajax({type:"GET",url:t.progressUrl,dataType:"json",beforeSend:function(e){e.setRequestHeader("X-Progress-ID",t.uuid)},success:function(r){if(null!=r){if("uploading"==r.state){r.percents=Math.floor(r.received/r.size*1e3)/10;var o=e.browser.webkit?e(t.progressBar,parent.document):e(t.progressBar);o.css({width:r.percents+"%"}),t.uploading(r)}("done"==r.state||"error"==r.state)&&(window.clearTimeout(t.timer),t.complete(r)),"done"==r.state&&t.success(r),"error"==r.state&&t.error(r)}}})}}(jQuery);
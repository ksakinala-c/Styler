function escapeHtml(e){return String(e).replace(/[&<>"'\/]/g,function(e){return entityMap[e]})}function show_preview(){var e=$(this).parents(".cart-item").data("display-type"),o=$(this).parents(".cart-item").data("delivery-type"),t=$(this).parents(".cart-item").data("item-name"),r=$(this).parents(".cart-item").data("item-message"),a="url("+$(this).data("faceplate")+")",i=$(this).data("custom-image"),s=$(this).siblings("img").data("video-name"),c=$("#cart-thumb-preview"),n=$("#cart-preview-name"),l=$("#cart-preview-message");r=r?r.replace(/\r?\n/g,"<br>"):"",("EM"===o||"PH"===o||"PL"===o&&"PHOTO"!==e||""===o)&&(c.removeClass("cart-uyop-preview"),$("#cart-preview-bg").css("background-image",a),c.hide()),"EM"!==o&&"PH"!==o||"PHOTO"!==e?"PL"===o&&"PHOTO"===e?($("#cart-preview-bg").css("background-image",""),c.addClass("cart-uyop-preview").show(),$("#cart-thumb-preview-image").attr("src",i).css({width:"100%",height:"100%"})):"VIDEO"===e&&$("#cart-video-text-preview span").html(s).closest("div").show():($("#cart-thumb-preview-image").attr("src",i),c.show());var m=25,p=510,d=$(this).parents("#preview-ref").offset(),h=$(this).offset(),u=h.top-d.top-m+"px",f=h.left-d.left-p+"px";$("#cart-preview").css("top",u).css("left",f).fadeIn(300),"PL"===o?(n.hide(),l.hide()):(""!==t?n.text(t).show():n.hide(),""!==r?l.html(escapeHtml(r)).show():l.hide())}function hide_preview(){$("#cart-preview, #cart-video-text-preview").fadeOut(300)}function setCart(){$(window).scroll(function(){update_cart_position()}),$(window).on("touchmove",function(){$("#cart").css("visibility","hidden")}),$(window).on("scrollstop",function(e){update_cart_position(),$("#cart").css("visibility","visible")})}function update_cart_position(){var e=10,o=$("#colA").offset().top,t=$(window).scrollTop(),r=$("#cart"),a=$("#main-content"),i=$("#colA").outerHeight(!0),s=r.offset().top,c=r.outerHeight(!0),n=s+c,l=a.offset().top+a.outerHeight(!0);i>c?!r.hasClass("cart-fixed")&&!r.hasClass("cart-absolute")&&t+e>=s?r.addClass("cart-fixed"):r.hasClass("cart-fixed")&&n>=l?r.addClass("cart-absolute").removeClass("cart-fixed"):r.hasClass("cart-absolute")&&s>=t+e?r.addClass("cart-fixed").removeClass("cart-absolute"):r.hasClass("cart-fixed")&&o>=s&&r.removeClass("cart-fixed"):c>=i&&a.height(c+180+"px")}var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},promoWatcher,hover_config={over:show_preview,timeout:100,out:hide_preview};$(document).ready(function(){function e(e){for(var o=window.location.search.substring(1),t=o.split("&"),r=0;r<t.length;r++){var a=t[r].split("=");return a[0]==e?window.promoCode||a[1]:window.promoCode}}setCart(),cartModel=new Cart(JSON.parse(jsonData.cart)),cartView=new CartView({model:cartModel}),topPromoView=new TopPromoBannerView({model:cartModel}),cartPromoView=new CartPromoBannerView({model:cartModel}),promoOverlayView=new PromoOverlayView({model:cartModel}),cartModel.trigger("change");var o=function(){return{checkPromoQualification:function(){var e=JSON.parse(cartModel.get("promo_data_serialized")),o=e.qualified;return o||void 0===o},showMessage:function(o,t){if(jsonData.showPromoMessages){var r,a;if($promoAlert=$("#promo-"+o),r=cartModel.get("promo_alias"),a=gettext("Your shopping cart has not yet qualified for the promotion with code "+r+". Please make the necessary adjustments to your cart to qualify for the promotion."),"LIMITED_BY_DISTINCT_EMAIL"===t.errorCode&&(a=gettext("We are sorry but you've already redeemed this promotion. Do you still want to complete your purchase?")),"alert"===o&&void 0!==t.url)$promoAlert.find("#alert-check-out").on("click",function(){window.location.href=t.url,$promoAlert.overlay().close()});else if("alert"===o&&void 0!==t.form)$promoAlert.find("#alert-check-out").on("click",function(){$promoAlert.overlay().close(),t.callback?t.callback(t.form):t.form.submit()});else if("message"===o)switch(r=e("promo_code"),t.errorCode){case"LIMITED_BY_SOLD_OUT":a=gettext("We're sorry - this promotion has sold out. You may add a different promo code or complete your purchase without one.");break;case"INVALID ALIAS":a=gettext("The promotion you are trying to use with code "+r+" is invalid. Please confirm the promotion.");break;case"INACTIVE ALIAS":a=gettext("The promotion you are trying to use with code "+r+" has expired or has not started. Please confirm the dates of the promotion.");break;default:a=gettext("The promotion you are trying to use with code "+r+" is invalid. Please confirm the promotion.")}$promoAlert.find("h1").html(a),$promoAlert.overlay({mask:"#ccc"}),cartModel.get("promo").sold_out_date&&"message"!==o?t.callback?t.callback(t.form):t.form.submit():($promoAlert.find("h1").html(a),$promoAlert.overlay({mask:"#ccc"}),$promoAlert.overlay().load())}}}};promoWatcher=new o,jsonData.promoErrors&&promoWatcher.showMessage("message",{errorCode:jsonData.promoErrors}),$("#continue-shopping").on("click",function(){var e=$("#order-add-another");e.attr("href")?window.location.href=e.attr("href"):$("#promo-alert").overlay().close()}),$("#payment-paypal").on("click",function(e){!promoWatcher.checkPromoQualification()&&jsonData.showPromoMessages&&(e.preventDefault(),promoWatcher.showMessage("alert",{form:this}))}),$("body").on("promoChangeEvent","#cart",function(e,o){promoWatcher.showMessage("message",{errorCode:o||jsonData.promoErrors})}),$("body").on("click",".promo-check",function(e){var o=e.currentTarget.href;!promoWatcher.checkPromoQualification()&&jsonData.showPromoMessages&&(e.preventDefault(),promoWatcher.showMessage("alert",{url:o}))})});